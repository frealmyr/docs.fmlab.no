
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutorials, tips and tricks for homelabs and cloud infrastructure whenever i feel a writers itch">
      
      
        <meta name="author" content="Fredrick Myrvoll">
      
      
        <link rel="canonical" href="https://docs.fmlab.no/homelab/docker/traefik/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>traefik - FM Lab</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Source Sans Pro";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/css/tables.css">
    
      <link rel="stylesheet" href="../../../assets/css/images.css">
    
      <link rel="stylesheet" href="../../../assets/css/codehilite.css">
    
      <link rel="stylesheet" href="../../../assets/css/footer.css">
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#traefik" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="FM Lab" class="md-header__button md-logo" aria-label="FM Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 9a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M7 19a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FM Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              traefik
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/frealmyr/docs.fmlab.no" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    frealmyr/docs.fmlab.no
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="FM Lab" class="md-nav__button md-logo" aria-label="FM Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 9a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M7 19a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2m13-6H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Z"/></svg>

    </a>
    FM Lab
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/frealmyr/docs.fmlab.no" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    frealmyr/docs.fmlab.no
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Homelab</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Homelab" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Homelab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../network/">Network</a>
          
            <label for="__nav_2_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Network" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../network/dns/" class="md-nav__link">
        DNS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../network/routing/" class="md-nav__link">
        Routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../network/reverse-proxy/" class="md-nav__link">
        Reverse Proxy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          traefik
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        traefik
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-docker-network" class="md-nav__link">
    Create docker network
  </a>
  
    <nav class="md-nav" aria-label="Create docker network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-traefik-container" class="md-nav__link">
    Basic traefik container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-traefik-configuration-files" class="md-nav__link">
    Basic Traefik configuration files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-traefik" class="md-nav__link">
    Starting Traefik
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-configuration-files" class="md-nav__link">
    Dynamic configuration files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#folder-structure-after-you-are-done" class="md-nav__link">
    Folder structure after you are done
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rootless-docker/" class="md-nav__link">
        rootless docker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../workstation/">Workstation</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Workstation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Workstation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workstation/configuration/dotfiles/" class="md-nav__link">
        dotfiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workstation/configuration/smb-automount/" class="md-nav__link">
        smb auto-mount
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Laptop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Laptop" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Laptop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../workstation/laptop/lenovo-x1-gen9/" class="md-nav__link">
        Lenovo X1 Carbon Gen 9
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../synology/">Synology</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Synology" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Synology
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../synology/docker/setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_2_2" type="checkbox" id="__nav_4_2_2" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2_2">
          Stacks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Stacks" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_2">
          <span class="md-nav__icon md-icon"></span>
          Stacks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../synology/docker/stacks/yarr/" class="md-nav__link">
        yarr
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../synology/docker/stacks/jellyfin/" class="md-nav__link">
        jellyfin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-docker-network" class="md-nav__link">
    Create docker network
  </a>
  
    <nav class="md-nav" aria-label="Create docker network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-traefik-container" class="md-nav__link">
    Basic traefik container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-traefik-configuration-files" class="md-nav__link">
    Basic Traefik configuration files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-traefik" class="md-nav__link">
    Starting Traefik
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-configuration-files" class="md-nav__link">
    Dynamic configuration files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#folder-structure-after-you-are-done" class="md-nav__link">
    Folder structure after you are done
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/frealmyr/docs.fmlab.no/edit/master/docs/homelab/docker/traefik.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="traefik">Traefik<a class="headerlink" href="#traefik" title="Permanent link">&para;</a></h1>
<p>This is a practical guide for using Traefik v2 with docker-compose, I used this pattern previously, but have now gone all-in on Kubernetes.</p>
<h2 id="create-docker-network">Create docker network<a class="headerlink" href="#create-docker-network" title="Permanent link">&para;</a></h2>
<p>First, lets make two docker networks dedicated to reverse proxying. One for our local network, and one for accessing externally outside our network. </p>
<blockquote>
<p>We seperate these, so that we can isolate applications that are accessible outside the network.</p>
</blockquote>
<p>Run the following commands to create the docker networks, these networks will be created in <a href="https://docs.docker.com/network/#network-drivers">bridge mode</a> and will persist after reboot</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>docker network create lab
docker network create web
</code></pre></div></td></tr></table></div>
<blockquote>
<p>We need to run these docker commands manually, defining these network in a <code>docker-compose.yml</code> will take down the networks if we run <code>docker-compose down</code>, which will make dependent containers fail to start.</p>
</blockquote>
<h3 id="basic-traefik-container">Basic traefik container<a class="headerlink" href="#basic-traefik-container" title="Permanent link">&para;</a></h3>
<p>If you have not already done it, I recommend to create a folder hierarchy for easier management of your docker-compose files, as mentioned in my <a href="https://fmlab.no/homelab/introduction/">introduction post.</a></p>
<blockquote>
<p>The volumes and network created by docker-compose will append the folder name to the docker resources, so in this case the internal network will be called <code>traefik_internal</code>.</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>mkdir -p <span class="nv">$HOME</span>/Homelab/System/traefik <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$HOME</span>/Homelab/System/traefik
</code></pre></div></td></tr></table></div>
<p>Inside the traefik folder, we can now create the <code>docker-compose.yml</code> file for traefik</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span><span class="w"></span>

<span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">lab</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">web</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">internal</span><span class="p">:</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">traefik</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=Europe/Oslo</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80:80</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443:443</span><span class="w"></span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internal</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lab</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/traefik.yml:/etc/traefik/traefik.yml</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/dynamic/:/etc/traefik/dynamic/</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/acme.json:/etc/traefik/acme/acme.json</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker-proxy</span><span class="w"></span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span><span class="w"></span>

<span class="w">  </span><span class="nt">docker-proxy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik_docker_proxy</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tecnativa/docker-socket-proxy:latest</span><span class="w"></span>
<span class="w">    </span><span class="c1"># image: tecnativa/docker-socket-proxy:arm32v7 # Raspberry Pi 32-bit host</span><span class="w"></span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internal</span><span class="w"></span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINERS=1</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span><span class="w"></span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L3:L8</td>
<td align="left">For networks, we add the docker network we created earlier as a external network. Which means that docker will try to connect to this network, but never create nor destroy it. We also have a internal network, which will only be used between services in this docker-compose.</td>
</tr>
<tr>
<td align="left">L15</td>
<td align="left">Change the timezone to your current one, this will be used by things like traefik dashboard and logs.</td>
</tr>
<tr>
<td align="left">L16:L18</td>
<td align="left">Traefik will bind to port 80 and 443 on the host, as this will be our primary reverse proxy.</td>
</tr>
<tr>
<td align="left">L19:L22</td>
<td align="left">Here we define the networks that Traefik will connect to, we will add more networks later for other integrations. Also, <em>L3:L8</em> only makes networks available for the containers.</td>
</tr>
<tr>
<td align="left">L23:L26</td>
<td align="left">The traefik configuration files, mounts files in the <code>traefik</code> folder into the container.</td>
</tr>
<tr>
<td align="left">L28</td>
<td align="left">The traefik container will not start before the docker proxy.</td>
</tr>
<tr>
<td align="left">L29</td>
<td align="left">Traefik will restart on reboot, unless you stop the application with <code>docker-compose down</code></td>
</tr>
<tr>
<td align="left">L31</td>
<td align="left">Mounting a container to the docker API on the host is a huge security risk, so we can use a sidecar container which will make only a partion of the API accessible to the traefik container over a dedicated docker network. I highly recommend to search the web for this topic.</td>
</tr>
<tr>
<td align="left">L37</td>
<td align="left">Here we can define which docker APIs that are available for read-only access, you can <a href="https://github.com/Tecnativa/docker-socket-proxy#grant-or-revoke-access-to-certain-api-sections">read more about the available APIs here</a>.</td>
</tr>
</tbody>
</table>
<h3 id="basic-traefik-configuration-files">Basic Traefik configuration files<a class="headerlink" href="#basic-traefik-configuration-files" title="Permanent link">&para;</a></h3>
<p>Now that we have the <code>docker-compose.yml</code> in place, we need to create the configuration files for traefik, which will be mounted from the root folder into the docker container.</p>
<p>First we need to create two folders in our traefik folder. Create a <code>config</code> folder and a <code>dynamic</code> folder inside the <code>config</code> folder.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>mkdir -p config/dynamic
</code></pre></div></td></tr></table></div>
<p>Inside the <code>config</code> folder we can now create a <code>traefik.yml</code> file, which will be the primary config file</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">entryPoints</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">http</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:80</span><span class="w"></span>
<span class="w">  </span><span class="nt">https</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">:443</span><span class="w"></span>

<span class="nt">certificatesResolvers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">letsEncrypt</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">acme</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;change@me.com&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/traefik/acme/acme.json&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">httpChallenge</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">entryPoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>

<span class="nt">providers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">docker</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lab</span><span class="w"></span>
<span class="w">    </span><span class="nt">exposedbydefault</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://docker-proxy:2375&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/traefik/dynamic/&quot;</span><span class="w"></span>

<span class="nt">api</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L1:L5</td>
<td align="left">Here we define which ports Traefik should listen on.</td>
</tr>
<tr>
<td align="left">L7:L13</td>
<td align="left">This bit is related to the automatic certificate generation for sites that are available externally, change the email to get warnings for expiring certificates.</td>
</tr>
<tr>
<td align="left">L17</td>
<td align="left">The default docker network when configuring backends, if the app runs in another network, this needs to be overridden by a label on the container.</td>
</tr>
<tr>
<td align="left">L18</td>
<td align="left">Do not expose containers when they are detected in the docker API, we need to add a <code>traefik.enabled</code> label to the container since this is false.</td>
</tr>
<tr>
<td align="left">L19</td>
<td align="left">Traefik connects to the docker-proxy over the <code>traefik_internal</code> network when connecting to the docker API.</td>
</tr>
<tr>
<td align="left">L21</td>
<td align="left">Traefik will monitor this directory for configuration files, and automatically reload these if there are any changes made to the files.</td>
</tr>
<tr>
<td align="left">L24</td>
<td align="left">Readies the dashboard by enabling the necessary APIs, further configuration is needed.</td>
</tr>
</tbody>
</table>
<h4 id="acme-certificate-file">ACME certificate file<a class="headerlink" href="#acme-certificate-file" title="Permanent link">&para;</a></h4>
<p>ACME requires a dedicated <code>acme.json</code> file for storing its certificates, create it by running</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>touch acme.json <span class="o">&amp;&amp;</span> chmod <span class="m">600</span> acme.json
</code></pre></div></td></tr></table></div>
<h3 id="starting-traefik">Starting Traefik<a class="headerlink" href="#starting-traefik" title="Permanent link">&para;</a></h3>
<p>We have now added all of the necessary static configuration files for running Traefik. We can now start Traefik to see if it is running properly</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>docker-compose up
</code></pre></div></td></tr></table></div>
<p>If the application starts, and there are no errors. You can close the session above, and let it run in the background</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>docker-compose up -d
</code></pre></div></td></tr></table></div>
<p>Now you should open up a new shell and follow the logs for the <code>traefik</code> container for the next steps, where you will see that <code>traefik</code> dynamically loads the configuration files as we edit them.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>docker ps <span class="p">|</span> grep traefik
docker logs -f &lt;traefik_container_id&gt;
</code></pre></div></td></tr></table></div>
<h3 id="dynamic-configuration-files">Dynamic configuration files<a class="headerlink" href="#dynamic-configuration-files" title="Permanent link">&para;</a></h3>
<p>Every configuration file that you create inside the <code>dynamic</code> folder, will be automatically reloaded. This makes it easy to create new routing rules, as you can listen for the Traefik container logs and check the endpoint while editing files for efficient setup.</p>
<p>Let's add two dynamic configurations, <code>dashboard.yml</code> for the Traefik dashboard and <code>redirect.yml</code> for redirecting any external sites from HTTP to HTTPS</p>
<p><code>dashboard.yml</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">http</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">routers</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Host(`traefik.lab`)</span><span class="w"></span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api@internal</span><span class="w"></span>
<span class="w">      </span><span class="nt">entryPoints</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="nt">docker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lab</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L4</td>
<td align="left">The domin where the Traefik dashboard will be available from.</td>
</tr>
<tr>
<td align="left">L5</td>
<td align="left">Connects the dashboard router to the traefik api which we made available in <code>traefik.yml</code></td>
</tr>
<tr>
<td align="left">L9</td>
<td align="left">Dashboard will only be available from the local <code>lab</code> network</td>
</tr>
</tbody>
</table>
<p><code>redirect.yml</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">http</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">routers</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">entryPoints</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">      </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HostRegexp(`{host:.+yourexternaldomain.com}`)</span><span class="w"></span>
<span class="w">      </span><span class="nt">middlewares</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https_redirect</span><span class="w"></span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noop</span><span class="w"></span>

<span class="w">  </span><span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">noop</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">loadBalancer</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">servers</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://10.0.0.33</span><span class="w"></span>

<span class="w">  </span><span class="nt">middlewares</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">https_redirect</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">redirectScheme</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class="w"></span>
<span class="w">        </span><span class="nt">permanent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L5</td>
<td align="left">This rule applies to incoming traffic on HTTP (Port 80)</td>
</tr>
<tr>
<td align="left">L6</td>
<td align="left">Only redirect traffic if its coming from yourexternaldomain.com, change to your own FQDN.</td>
</tr>
<tr>
<td align="left">L7:L8</td>
<td align="left">If the L6 rule is active, use the <code>https_redirect</code> middleware on L17:L21</td>
</tr>
<tr>
<td align="left">L11:L15</td>
<td align="left">Services are used for forwarding traffic, since we only want to redirect the traffic to HTTPS, we set this to the host ip.</td>
</tr>
<tr>
<td align="left">L17:L21</td>
<td align="left">Use the <code>redirectScheme</code> middleware to redirect the request from HTTP to HTTPS</td>
</tr>
</tbody>
</table>
<h3 id="folder-structure-after-you-are-done">Folder structure after you are done<a class="headerlink" href="#folder-structure-after-you-are-done" title="Permanent link">&para;</a></h3>
<p>When you are done with all the config files above, the <code>traefik</code> folder should look like this</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>frealmyr@FM-SRV:~/Homelab/System$ tree -L <span class="m">3</span> traefik/
traefik/
 config
    acme.json
    dynamic
       dashboard.yml
       redirect.yml
    traefik.yml
 docker-compose.yml
</code></pre></div></td></tr></table></div>
<p>Next, take a look at the <a href="https://fmlab.no/homelab/traefik-usage/">Traefik Usage</a> guide, and/or the <a href="https://fmlab.no/homelab/pihole/">PiHole</a> guide for resolving <code>.lab</code> HTTP requests.</p>
<h1 id="practical-examples">Practical examples<a class="headerlink" href="#practical-examples" title="Permanent link">&para;</a></h1>
<h2 id="use-case-1-local-lab-network-only">Use Case 1: Local lab network only<a class="headerlink" href="#use-case-1-local-lab-network-only" title="Permanent link">&para;</a></h2>
<p>Local network only example using <a href="https://github.com/bastienwirtz/homer">homer</a>, which is available from http://home.lab/, if you have setup a DNS server as i have done in the <a href="https://fmlab.no/homelab/pihole/">PiHole</a> guide.</p>
<p>Example <code>.env</code> enviroment file, which i use for all my Traefik applications</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Project</span>
<span class="nv">PROJECT</span><span class="o">=</span>home
<span class="nv">DOMAIN</span><span class="o">=</span>lab
<span class="nv">PORT</span><span class="o">=</span><span class="m">80</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span><span class="w"></span>

<span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">lab</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">homer</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">homer</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b4bz/homer:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/assets/:/www/assets</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/config.yml:/www/config.yml</span><span class="w"></span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lab</span><span class="w"></span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.enable=true</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PROJECT}.entryPoints=http</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PROJECT}.rule=Host(`home.${DOMAIN}`)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.services.${PROJECT}.loadbalancer.server.port=${PORT}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L3:L5</td>
<td align="left">We only want homer to be accessible from our <code>lab</code> network</td>
</tr>
<tr>
<td align="left">L14:L15</td>
<td align="left">The network will be mounted by the container</td>
</tr>
<tr>
<td align="left">L17</td>
<td align="left">In <code>traefik.yaml</code> we have set <code>exposedbydefault: false</code>, so we need to enable Traefik for this application</td>
</tr>
<tr>
<td align="left">L18</td>
<td align="left">Tell Traefik that the entrypoint for this application is over <strong>HTTP</strong></td>
</tr>
<tr>
<td align="left">L19</td>
<td align="left">Here we define the domain that Traefik should redirect traffic to this application, which is now <code>http://home.lab</code></td>
</tr>
<tr>
<td align="left">L20</td>
<td align="left">This is the port that the application is listening for. If the application have a <code>EXPOSE</code> port defined in the Dockerfile, then Traefik should be able to auto-detect this.</td>
</tr>
</tbody>
</table>
<h2 id="use-case-2-accessible-from-the-internet">Use Case 2: Accessible from the internet<a class="headerlink" href="#use-case-2-accessible-from-the-internet" title="Permanent link">&para;</a></h2>
<p>Continuing with the example above, we make some slight changes</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Project</span>
<span class="nv">PROJECT</span><span class="o">=</span>home
<span class="nv">DOMAIN</span><span class="o">=</span>yourdomain.com
<span class="nv">PORT</span><span class="o">=</span><span class="m">80</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.5&#39;</span><span class="w"></span>

<span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">web</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>

<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">homer</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">homer</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b4bz/homer:latest</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/assets/:/www/assets</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/config.yml:/www/config.yml</span><span class="w"></span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w"></span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.enable=true</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PROJECT}.entryPoints=https</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PROJECT}.rule=Host(`${PROJECT}.${DOMAIN}`)</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.${PROJECT}.tls.certresolver=letsEncrypt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.services.${PROJECT}.loadbalancer.server.port=${PORT}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<table class="table">
<thead>
<tr>
<th align="left">Line</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">L3:L5</td>
<td align="left">Now we want homer to be accessible from the internet over the <code>web</code> network</td>
</tr>
<tr>
<td align="left">L14:L15</td>
<td align="left">The network will be mounted by the container</td>
</tr>
<tr>
<td align="left">L17</td>
<td align="left">In <code>traefik.yaml</code> we have set <code>exposedbydefault: false</code>, so we need to enable Traefik for this application</td>
</tr>
<tr>
<td align="left">L18</td>
<td align="left">Tell Traefik that the entrypoint for this application is over <strong>HTTPS</strong></td>
</tr>
<tr>
<td align="left">L19</td>
<td align="left">Here we define the domain that Traefik should redirect traffic to this application, which is now <code>https://home.yourdomain.com</code></td>
</tr>
<tr>
<td align="left">L20</td>
<td align="left">This is the port that the application is listening for. If the application have a <code>EXPOSE</code> port defined in the Dockerfile, then Traefik should be able to auto-detect this.</td>
</tr>
</tbody>
</table>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 24, 2023</span>
      
    
  </small>
</div>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../network/reverse-proxy/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Reverse Proxy" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Reverse Proxy
            </div>
          </div>
        </a>
      
      
        
        <a href="../rootless-docker/" class="md-footer__link md-footer__link--next" aria-label="Next: rootless docker" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              rootless docker
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.indexes", "navigation.top", "navigation.tracking", "search.suggest"], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>